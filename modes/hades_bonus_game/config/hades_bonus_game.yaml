#config_version=5
#
# http://docs.missionpinball.org/en/latest/config/mode.html?highlight=pause%20mode use wait queue
# Look to oldmachine 1 May19 for working hades game.
# Currently ball is brought into play using a multiball on the hades pf.
#
#Message with hades face Redeemed or Stay is sent from led fades in shows.
# Note most shows are in the common show folder because they are shared with other hades game
#
#
#
#
#
#
#
#do:  Add a show for extra ball. Consider adding bats as widgets. Have bats fly across screen.
# Consider controling mode with state machine to allow mode to continue after ball earned.
# ways to improve: allow ball to play out after extra ball earned. May be best not to deal with this as an
# multiball but rather a request ball to pf and enable a ball save. Consider switching lower trough
# to an untagged ball device and control ball entry to underworld via its eject events and instead of
# ball save simply have it re-eject if within the window
#
#Note: tag trough removed from hardware on lower trough. if problems, put back in and troubleshoot other haded mode.
#Looks like trough having only tag home causes to re-eject (verify) adding tag trough registers a ball drain which was
#OK for starting this as a mb but not for running it off the coil drivers.  May have to convert back.
mode:
  priority: 2600 # range 100-1M
  start_events:
#    - game_ending
#    - ball_ending
#    - ball_hold_hades_door_held_ball
#     - mode_bonus_starting # enter_hades_from_bonus_mode
     - enter_hades_from_relay_player #posted by base
     - key_h_pressed

  stop_events:
    - hades_final_show_finished
#  use_wait_queue: true

#multiballs:
#  hades_play:
#    source_playfield: hades_pf
#    ball_count: 1
#    ball_count_type: add  # increase number of playfield balls by count
#    shoot_again: 24s #ball save for MB 10 sec is default  Ball save does not work if there is a ball in the upstairs trough
#    start_events: hades_bonus_intro_show_done
#    stop_events: hades_ball_awarded #Kills the shoot again if ball earned while still in play
#    debug: true



#This starts the ball in play.  Immunity ball save is handled thoough showplayer and a timer.
coil_player:
  hades_bonus_intro_show_done: c_u_trough_eject



variable_player:
  s_u_left_slingshot_active:
    score: 500
  s_u_right_slingshot_active:
    score: 500
  s_u_left_target_active:
    score: 1000
  s_u_middle_target_active:
    score: 1500
  s_u_right_target_active:
    score: 1000
  left_river_top_to_bottom_hit: #River A
    score: 1750
  left_river_bottom_to_top_hit: # River B
    score: 2500
  right_river_top_to_bottom_hit: #River C
    score: 1750
  right_river_bottom_to_top_hit: #River D
    score: 2500
  ball_started:                  # reset rivers to 0 with ball start
    rivers_lit:
      int: 0
      action: set
  timer_river_a_started:
    rivers_lit: 1
  timer_river_a_complete:
    rivers_lit: -1
  timer_river_b_started:
    rivers_lit: 1
  timer_river_b_complete:
    rivers_lit: -1
  timer_river_c_started:
    rivers_lit: 1
  timer_river_c_complete:
    rivers_lit: -1
  timer_river_d_started:
    rivers_lit: 1
  timer_river_d_complete:
    rivers_lit: -1

accruals:
  mag_holds:
    events: #first line AND second line both registered results in turn on the bounce
      - diverter_grab_a_deactivating, diverter_grab_b_deactivating # A OR B
      - diverter_grab_c_deactivating, diverter_grab_d_deactivating # C OR D
    events_when_complete: accelerate_rivers #All river fast modes activate when this is posted rules are cleared when this mode ends

event_player:
  timer_river_a_started{device.timers.river_b.running and device.timers.river_c.running and device.timers.river_d.running}: hades_ball_awarded
  timer_river_b_started{device.timers.river_a.running and device.timers.river_c.running and device.timers.river_d.running}: hades_ball_awarded
  timer_river_c_started{device.timers.river_a.running and device.timers.river_b.running and device.timers.river_d.running}: hades_ball_awarded
  timer_river_d_started{device.timers.river_a.running and device.timers.river_b.running and device.timers.river_c.running}: hades_ball_awarded
  #  s_accessory_active: hades_ball_awarded #just for Testing

sequence_shots: #using to activate timers
  left_river_top_to_bottom: #River A
    playfield: hades_pf
    switch_sequence:
      - s_u_left_ear_3
      - s_u_left_ear_0
    sequence_timeout: 1s
  left_river_bottom_to_top: # River B
    playfield: hades_pf
    switch_sequence:
      - s_u_left_ear_0
      - s_u_left_ear_3
    sequence_timeout: 1s
  right_river_top_to_bottom: #River C
    playfield: hades_pf
    switch_sequence:
      - s_u_right_ear_3
      - s_u_right_ear_0
    sequence_timeout: 1s
  right_river_bottom_to_top: #River D
    playfield: hades_pf
    switch_sequence:
      - s_u_right_ear_0
      - s_u_right_ear_3
    sequence_timeout: 1s

shot_profiles:
  progression:
    states:
      - name: first_pass
        show: off #safe to remove?
      - name: additional_pass
        show: on #safe to remove?
    loop: no

shots: #writing to control diverter activity in hardeare
  river_a: #top left to bottom left
     playfield: hades_pf
     enable_events: mode_hades_bonus_game_started
     disable_events: accelerate_rivers
     hit_events: left_river_top_to_bottom_hit
#     show_tokens:
#       lights: u_mouth_A_flasher
     profile: progression
     reset_events: mode_hades_bonus_game_started
#       - ball_started
#       - timer_river_a_complete
  river_b: #bottom left to top left
     playfield: hades_pf
     enable_events: mode_hades_bonus_game_started
     disable_events: accelerate_rivers
     hit_events: left_river_bottom_to_top_hit
#     show_tokens:
#       lights: u_mouth_B_flasher
     profile: progression
     reset_events: mode_hades_bonus_game_started
  river_c: #top right to bottom right
     playfield: hades_pf
     enable_events: mode_hades_bonus_game_started
     disable_events: accelerate_rivers
     hit_events: right_river_top_to_bottom_hit
#     show_tokens:
#       lights: u_mouth_C_flasher
     profile: progression
     reset_events: mode_hades_bonus_game_started
  river_d: #bottom right to top right
     playfield: hades_pf
     enable_events: mode_hades_bonus_game_started
     disable_events: accelerate_rivers
     hit_events: right_river_bottom_to_top_hit
#     show_tokens:
#       lights: u_mouth_D_flasher
     profile: progression
     reset_events: mode_hades_bonus_game_started

timers:
  hades_immunity: #Ball save timer for underworld 20 sec total Used as conditional against u trough eject event in hardware
    start_value: 4
    end_value: 0
    direction: down
    tick_interval: 5100 ms
    control_events:
      - action: start
        event: hades_bonus_intro_show_done
      #Next events stop ball save activity if extra ball awarded before timer finishes
      - action: stop
        event: extra_ball_not_earned
  ball_eject_refractory: #To keep eject coil from retriggering from plunger bouncing.
    start_value: 1
    end_value: 0
    tick_interval: 600 ms
    direction: down
    control_events:
#      - action: start
#        event: hades_bonus_intro_show_done
      - action: restart
        event: s_u_trough_1_active
      #Next events stop ball save activity if extra ball awarded before timer finishes
      - action: stop
        event: extra_ball_not_earned
      - action: stop
        event: hades_ball_awarded
#      - action: start
#        event:
#          - s_u_trough_1_active
  river_a: #activates on sequence shot not shot
    debug: true
#    restart_on_complete: yes
    start_value: 130 #20
    end_value: 0
    direction: down
    tick_interval: 1s
    control_events:
      - action: start
        event: left_river_top_to_bottom_hit
      - action: restart
#        event: left_river_top_to_bottom_hit
#      - action: reset
        event: timer_river_a_complete
      - action: stop
        event: mode_hades_bonus_game_stopping
#      - action: paues
#        event: diverter_left_mag_A_disabling
#        value: 2 s
#      - action: jump
#        value: 0
#        event: diverter_left_grab_A_deactivating
  river_b:
    debug: true
    start_value: 130 #30
    end_value: 0
    direction: down
    tick_interval: 1s
    control_events:
      - action: start
        event: left_river_bottom_to_top_hit
      - action: restart
#        event: left_river_bottom_to_top_hit
#      - action: reset
        event: timer_river_b_complete
      - action: stop
        event: mode_hades_bonus_game_stopping
#      - action: jump
#        value: 0
#        event: diverter_left_grab_B_deactivating
  river_c:
    debug: true
    start_value: 130 #20
    end_value: 0
    direction: down
    tick_interval: 1s
    control_events:
      - action: start
        event: right_river_top_to_bottom_hit
      - action: restart
#        event: right_river_top_to_bottom_hit
#      - action: reset
        event: timer_river_c_complete
      - action: stop
        event: mode_hades_bonus_game_stopping
#      - action: jump
#        value: 0
#        event: diverter_left_grab_C_deactivating
  river_d:
    debug: true
    start_value: 130 #30
    end_value: 0
    direction: down
    tick_interval: 1s
    control_events:
      - action: start
        event: right_river_bottom_to_top_hit
      - action: restart
#        event: right_river_bottom_to_top_hit
#      - action: reset
        event: timer_river_d_complete
      - action: stop
        event: mode_hades_bonus_game_stopping
#      - action: jump
#        value: 0
#        event: diverter_left_grab_D_deactivating

extra_balls:
    my_mode_eb:
      award_events: hades_ball_awarded

sequences:
    failing_path:
       events:
         - timer_hades_immunity_complete
         - s_u_trough_1_active{not device.timers.hades_bug_immunity.running}
         #- balldevice_bd_u_trough_ball_enter
       events_when_complete: extra_ball_not_earned

slide_player:
  start_countdown_movie:
    hades_score_screen_slide:
      target: score_lcd
      widgets:
      - type: image
        image: hades_back_box
        anchor_y: top
        y: 100%
        z: 0
      - type: text
        text: (score)
        number_grouping: true
        min_digits: 2
        font_size: 500
        y: 70%
        x: 65%
        font_name: greekgods3
        color: black
        opacity: 1
        z: 2
      - type: text
        text: (score)
        number_grouping: true
        min_digits: 2
        font_size: 500
        y: 69.7%
        x: 65.3%
        font_name: greekgods3
        color: red
        opacity: 0.7
        z: 1
      - type: text
        text: PLAYER (number)
        y: 15%
        x: 50%
        font_size: 100
        font_name: greekgods3
        color: black
        opacity: 1
        z: 2
      - type: text
        text: PLAYER (number)
        y: 14.7%
        x: 50.3%
        font_size: 100
        font_name: greekgods3
        color: black
        opacity: 0.5
        z: 1
      - type: text
        text: "BALL  In Underworld"
        y: 15%
        x: 80%
        font_size: 100
        font_name: greekgods3
        opacity: 1
        color: black
        z: 2
      - type: text
        text: "BALL  In Underworld"
        y: 14.7%
        x: 80.3%
        font_size: 100
        font_name: greekgods3
        color: black
        opacity: 0.5
        z: 1
      transition:
        type: fade
        duration: 1s
      transition_out:
        type: fade
        duration: 1s

    hades_playfield_slide:
      target: playfield_lcd
      background_color: black
      widgets:
      - type: video
        video: hadescntdown710^2h264fps30 # hadescountdown
        auto_play: true
        z: 200
        y: 50%
        anchor_x: center
        anchor_y: center
  hades_bonus_intro_show_done:
    hades_playfield_slide:
      target: playfield_lcd
      background_color: white
      widgets:
      - type: text
        text: Shoot The
        font_name: greekgods3
        color: white
        y: 6%
        x: 19%
        anchor_x: center
        anchor_y: bottom
        font_size: 50
        z: 3
      - type: text
        text: Tunnels
        font_name: greekgods3
        color: white
        y: 6%
        x: 85%
        anchor_x: center
        anchor_y: bottom
        font_size: 50
        z: 3
      - type: image
        image: hades_mask
        anchor_y: top
        y: 102%
        opacity: 1
        z: 2
      - type: image
        image: bat
        scale: 0.3
        y: 88%
        x: 67%
        anchor_x: center
        anchor_y: center
        z: 1
        opacity: 0
        animations:
          timer_river_c_started:
            - property: opacity
              value: 1
              duration:  .3s
              easing: linear
            - property: opacity
              value: 1
              duration:  130s #14s
              easing: out_back
            - property: opacity
              value: 0
              duration:  .5s
      - type: image
        image: bat
        scale: 0.3
        y: 65%
        x: 80%
        anchor_x: center
        anchor_y: center
        z: 1
        opacity: 0
        animations:
          timer_river_d_started:
            - property: opacity
              value: 1
              duration:  .3s
              easing: linear
            - property: opacity
              value: 1
              duration:  130s #14s
              easing: out_back
            - property: opacity
              value: 0
              duration:  .5s
      - type: image
        image: bat
        scale: 0.3
        y: 65%
        x: 20%
        anchor_x: center
        anchor_y: center
        z: 1
        opacity: 0
        animations:
          timer_river_b_started:
            - property: opacity
              value: 1
              duration:  .3s
              easing: linear
            - property: opacity
              value: 1
              duration:  130s #14s
              easing: out_back
            - property: opacity
              value: 0
              duration:  .5s
      - type: image
        image: bat
        scale: 0.3
        y: 88%
        x: 25%
        anchor_x: center
        anchor_y: center
        z: 1
        opacity: 0
        animations:
          timer_river_a_started:
            - property: opacity
              value: 1
              duration:  .3s
              easing: linear
            - property: opacity
              value: 1
              duration:  130s #14s
              easing: out_back
            - property: opacity
              value: 0
              duration:  .5s
  accelerate_rivers:
    bb_accelerate_slide:
      target: score_lcd
      expire: 3s
      background_color: red
      widgets:
      - type: text
        text: Acceleration Mode!
        color: black
        font_size: 350
        font_name: greekgods3

show_player:
  #Here is the hades ballsave. using a show to allow ball to settle before kicking it out.
  timer_ball_eject_refractory_complete{device.switches.s_u_trough_1.state==1}: #s_u_trough_1_active{device.timers.hades_immunity.running}:
    show_lower_trough_eject: # this show pulses the trough eject.
      speed: 1
      loops: 0
  s_u_trough_1_active{device.timers.hades_immunity.running}:
    show_lower_trough_delayed_eject: # this show pulses the trough eject after a brief settle delay.
      speed: 1
      loops: 0
  mode_hades_bonus_game_started:
    show_all_pf_bb_leds_red:
      loops: -1 #speed: 1
    show_four_flashes_mini_pf:
      speed: 14
      loops: 0
      events_when_played: start_countdown_movie
      events_when_completed: hades_bonus_intro_show_done
  hades_ball_awarded:
    #First 3 stops are to put a halt on BS timer display and ejecting the ball again while mode winds down Also timers are stopped above
    countdown20_red: #LED ball save timer
      action: stop
    show_lower_trough_eject:
      action: stop
    show_lower_trough_delayed_eject:
      action: stop
    show_leds_red_to_white:
      speed: 4
      loops: 0
      events_when_completed: hades_final_show_finished
  extra_ball_not_earned:
    #First 2 stops are to put a halt on ejecting the ball again while mode winds down Also timers are stopped above
    show_lower_trough_eject:
      action: stop
    show_lower_trough_delayed_eject:
      action: stop
    show_wind_down_red:
      speed: 4
      loops: 0
      events_when_completed: hades_final_show_finished
  hades_bonus_intro_show_done:
    countdown20_red: #LED ball save timer
      speed: 1
      loops: 0
  accelerate_rivers:
    show_pulse_leds_red:
      speed: 8 #Default loops=-1 meaning until the calling mode ends
#  s_u_left_target_active:
#    show_hades_left_target:
#      speed: 20
#      loops: 0
#  s_u_right_target_active:
#    show_hades_right_target:
#      speed: 20
#      loops: 0
#  s_u_middle_target_active:
#    show_hades_middle_target:
#      speed: 20
#      loops: 0
  #Next 4 shows give a 1 sec flash when a grab event happens
#  diverter_grab_a_activating:
#  diverter_grab_b_activating:
#  diverter_grab_c_activating:
#  diverter_grab_d_activating:
  #Next 4 shows give a red flash with an accelerate triggering event but flash unnecessarily if time out prevents a trigger
#  left_river_top_to_bottom_hit{device.accruals.mag_holds.completed}:
#    show_hades_left_ss_red:
#      speed: 10
#      loops: 0
#  left_river_bottom_to_top_hit{device.accruals.mag_holds.completed}:
#    show_hades_left_ss_red:
#      speed: 10
#      loops: 0
#  right_river_top_to_bottom_hit{device.accruals.mag_holds.completed}:
#    show_hades_right_ss_red:
#      speed: 10
#      loops: 0
#  right_river_bottom_to_top_hit{device.accruals.mag_holds.completed}:
#    show_hades_right_ss_red:
#      speed: 10
#      loops: 0

widgets:
  scored_1000_left:
      type: text
      text: 1000
      font_name: greekgods3
      color: black
      opacity: 1
      z: 3
      y: 85%
      x: 10%
      anchor_x: center
      anchor_y: bottom
      font_size: 60
      expire: 1500ms
      animations:
        add_to_slide:
          - property: x,y,opacity
            value: -2%, 5%, -1
            relative: true
            duration:  1500ms
  scored_1000_right:
      type: text
      text: 1000
      font_name: greekgods3
      color: black
      opacity: 1
      z: 3
      y: 85%
      x: 81%
      anchor_x: center
      anchor_y: bottom
      font_size: 60
      expire: 1500ms
      animations:
        add_to_slide:
          - property: x,y,opacity
            value: 2%, 5%, -1
            relative: true
            duration:  1500ms
  scored_1500_center:
      type: text
      text: 1500
      font_name: greekgods3
      color: black
      opacity: 1
      z: 3
      y: 85%
      x: 50%
      anchor_x: center
      anchor_y: bottom
      font_size: 60
      expire: 1500ms
      animations:
        add_to_slide:
          - property: y, opacity
            value: 5%, -1
            relative: true
            duration:  1500ms

widget_player:
  s_u_left_target_active:
    scored_1000_left:
      target: playfield_lcd
  s_u_middle_target_active:
    scored_1500_center:
      target: playfield_lcd
  s_u_right_target_active:
    scored_1000_right:
      target: playfield_lcd

sound_player:
  timer_river_a_started: snd_bat1
  timer_river_b_started: snd_bat2
  timer_river_c_started: snd_bat3
  timer_river_d_started: snd_bat4
  s_u_left_target_active: snd_hades_target
  s_u_middle_target_active: snd_hades_target
  s_u_right_target_active: snd_hades_target
  mode_hades_bonus_game_started: v_game_not_over
  extra_ball_not_earned: v_your_soul_stays
  hades_ball_awarded: v_you_returned_underworld
  hades_bonus_intro_show_done: v_shoot_tunnels_bats
#  extra_ball_not_earned: snd_deadmans_tail #Origionally in sound effects was this mode_hades_bonus_game_stopping: snd_deadmans_tail moved 3/12/22
light_player:
  mode_hades_bonus_game_started:
    l_backlight_rgb:
      color: 0000ff #000000
    l_backlight_w:
      color: A0
  timer_river_a_started:
    l_mouth_a:
      color: white
  timer_river_a_complete:
    l_mouth_a:
      color: black
  timer_river_b_started:
    l_mouth_b:
      color: white
  timer_river_b_complete:
    l_mouth_b:
      color: black
  timer_river_c_started:
    l_mouth_c:
      color: white
  timer_river_c_complete:
    l_mouth_c:
      color: black
  timer_river_d_started:
    l_mouth_d:
      color: white
  timer_river_d_complete:
    l_mouth_d:
      color: black
